// ðŸš€ AUTO-COMPLETE CORRIGIDO - AGUARDA CAMPOS CONDICIONAIS
// Cole este cÃ³digo no console do navegador (F12) e execute

function preencherFormularioCaseiroCorrigido() {
    console.log('ðŸš€ Iniciando preenchimento com aguardo de campos condicionais...');
    
    // ===== FUNÃ‡Ã•ES AUXILIARES MELHORADAS =====
    const aguardarCampo = (selector, timeout = 3000) => {
        return new Promise((resolve) => {
            const elemento = document.querySelector(selector);
            if (elemento) {
                resolve(elemento);
                return;
            }
            
            const observer = new MutationObserver(() => {
                const elemento = document.querySelector(selector);
                if (elemento) {
                    observer.disconnect();
                    resolve(elemento);
                }
            });
            
            observer.observe(document.body, {
                childList: true,
                subtree: true,
                attributes: true
            });
            
            setTimeout(() => {
                observer.disconnect();
                resolve(null);
            }, timeout);
        });
    };
    
    const preencherCampoSeguro = async (id, valor) => {
        let campo = document.getElementById(id);
        
        if (!campo) {
            console.log(`â³ Aguardando campo: ${id}`);
            campo = await aguardarCampo(`#${id}`);
        }
        
        if (campo) {
            campo.value = valor;
            campo.dispatchEvent(new Event('input', { bubbles: true }));
            campo.dispatchEvent(new Event('change', { bubbles: true }));
            console.log(`âœ… ${id}: ${valor}`);
            return true;
        } else {
            console.warn(`âš ï¸ Campo nÃ£o encontrado apÃ³s aguardar: ${id}`);
            return false;
        }
    };
    
    const selecionarRadioSeguro = async (name, value) => {
        let radio = document.querySelector(`input[name="${name}"][value="${value}"]`);
        
        if (!radio) {
            console.log(`â³ Aguardando radio: ${name}=${value}`);
            radio = await aguardarCampo(`input[name="${name}"][value="${value}"]`);
        }
        
        if (radio) {
            radio.checked = true;
            radio.dispatchEvent(new Event('change', { bubbles: true }));
            console.log(`âœ… ${name}: ${value}`);
            return true;
        } else {
            console.warn(`âš ï¸ Radio nÃ£o encontrado: ${name}=${value}`);
            return false;
        }
    };
    
    const selecionarSelectSeguro = async (id, value) => {
        let select = document.getElementById(id);
        
        if (!select) {
            console.log(`â³ Aguardando select: ${id}`);
            select = await aguardarCampo(`#${id}`);
        }
        
        if (select) {
            select.value = value;
            select.dispatchEvent(new Event('change', { bubbles: true }));
            console.log(`âœ… ${id}: ${value}`);
            return true;
        } else {
            console.warn(`âš ï¸ Select nÃ£o encontrado: ${id}`);
            return false;
        }
    };

    const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));

    // ===== SEQUÃŠNCIA DE PREENCHIMENTO =====
    async function executarPreenchimento() {
        try {
            // 1. TREINAMENTO (FUNDAMENTAL - DESBLOQUEIA O RESTO)
            console.log('ðŸ“š 1. Configurando treinamento...');
            await selecionarRadioSeguro('aceitaTreinamento', 'sim');
            await delay(500);
            await selecionarSelectSeguro('turnoTreinamento', 'manha');
            await delay(1000);

            // 2. DADOS PESSOAIS
            console.log('ðŸ‘¤ 2. Preenchendo dados pessoais...');
            await preencherCampoSeguro('nomeCompleto', 'JoÃ£o Silva Santos');
            await preencherCampoSeguro('dataNascimento', '1985-03-15');
            await preencherCampoSeguro('cpf', '123.456.789-10');
            await preencherCampoSeguro('rg', '12.345.678-9');
            await selecionarSelectSeguro('estadoCivil', 'casado');
            await preencherCampoSeguro('nacionalidade', 'Brasileira');
            await delay(500);

            // 3. CONTATO
            console.log('ðŸ“ž 3. Preenchendo contatos...');
            await preencherCampoSeguro('telefone', '(11) 99999-8888');
            await preencherCampoSeguro('whatsapp', '(11) 98888-7777');
            await preencherCampoSeguro('email', 'joao.santos@email.com');
            await preencherCampoSeguro('endereco', 'Rua das Flores, 123 - Vila EsperanÃ§a, SÃ£o Paulo, SP');
            await preencherCampoSeguro('cep', '01234-567');
            await delay(500);

            // 4. CNH (CONDICIONAL)
            console.log('ðŸš— 4. Configurando CNH...');
            await selecionarRadioSeguro('possuiCnh', 'sim');
            await delay(300); // Aguardar campo condicional aparecer
            await selecionarSelectSeguro('categoriaCnh', 'B');
            await delay(300);

            // 5. FILHOS (CONDICIONAL)
            console.log('ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ 5. Configurando filhos...');
            await selecionarRadioSeguro('temFilhos', 'sim');
            await delay(300); // Aguardar campos condicionais
            await preencherCampoSeguro('quantosFilhos', '2');
            await preencherCampoSeguro('idadesFilhos', '8 e 12 anos');
            await delay(500);

            // 6. EXPERIÃŠNCIA PROFISSIONAL
            console.log('ðŸ’¼ 6. ExperiÃªncia profissional...');
            await selecionarSelectSeguro('tempoExperiencia', '3-5-anos');
            await selecionarRadioSeguro('experienciaAltoPadrao', 'sim');
            await delay(300);
            await preencherCampoSeguro('tempoAltoPadrao', '2 anos');
            await delay(500);

            // 7. REFERÃŠNCIAS (OBRIGATÃ“RIAS)
            console.log('ðŸ“‹ 7. Preenchendo referÃªncias...');
            await preencherCampoSeguro('ref1Nome', 'Maria Silva');
            await preencherCampoSeguro('ref1Telefone', '(11) 99988-7766');
            await preencherCampoSeguro('ref1Inicio', '2021-01');
            await preencherCampoSeguro('ref1Fim', '2023-12');
            await selecionarSelectSeguro('ref1Relacao', 'ex-patrao');
            await preencherCampoSeguro('ref1MotivoSaida', 'MudanÃ§a da famÃ­lia para outro estado');
            
            // ReferÃªncia 2 (opcional)
            await preencherCampoSeguro('ref2Nome', 'Carlos Santos');
            await preencherCampoSeguro('ref2Telefone', '(11) 98877-6655');
            await preencherCampoSeguro('ref2Inicio', '2019-03');
            await preencherCampoSeguro('ref2Fim', '2020-12');
            await selecionarSelectSeguro('ref2Relacao', 'supervisor');
            await preencherCampoSeguro('ref2MotivoSaida', 'TÃ©rmino do contrato');
            await delay(500);

            // 8. ÃšLTIMO EMPREGO
            console.log('ðŸ¢ 8. Ãšltimo emprego...');
            await preencherCampoSeguro('ultimoEmpregoEmpresa', 'FamÃ­lia Santos');
            await preencherCampoSeguro('ultimoEmpregoCargo', 'Caseiro');
            await preencherCampoSeguro('ultimoEmpregoTempo', '2 anos e 6 meses');
            await preencherCampoSeguro('ultimoEmpregoSalario', 'R$ 2.300,00');
            await preencherCampoSeguro('ultimoEmpregoAtividades', 'ManutenÃ§Ã£o geral da propriedade, cuidados com jardim, limpeza de Ã¡reas externas, pequenos reparos elÃ©tricos e hidrÃ¡ulicos.');
            await preencherCampoSeguro('ultimoEmpregoAprendizados', 'Aprendi muito sobre manutenÃ§Ã£o de piscinas e sistemas de irrigaÃ§Ã£o automÃ¡tica.');
            await preencherCampoSeguro('ultimoEmpregoDificuldades', 'Inicialmente tive dificuldades com equipamentos modernos, mas consegui me adaptar.');
            await delay(500);

            // 9. COMPETÃŠNCIAS TÃ‰CNICAS
            console.log('ðŸ”§ 9. CompetÃªncias tÃ©cnicas...');
            await selecionarSelectSeguro('manutencaoEletrica', 'intermediario');
            await selecionarSelectSeguro('manutencaoHidraulica', 'basico');
            await selecionarSelectSeguro('cuidadosJardim', 'intermediario');
            await selecionarSelectSeguro('cuidadosPiscina', 'avancado');
            await selecionarSelectSeguro('experienciaSeguranca', 'basico');
            await selecionarSelectSeguro('automacaoResidencial', 'intermediario');
            
            // Equipamentos
            const equipamentos = ['cortador-grama', 'rocadeira', 'lavadora-alta-pressao'];
            for (const eq of equipamentos) {
                const checkbox = document.querySelector(`input[name="equipamentosJardinagem"][value="${eq}"]`);
                if (checkbox) {
                    checkbox.checked = true;
                    checkbox.dispatchEvent(new Event('change', { bubbles: true }));
                }
            }
            await delay(500);

            // 10. DISPONIBILIDADE
            console.log('ðŸ“… 10. Disponibilidade...');
            await selecionarRadioSeguro('inicioImediato', 'nao');
            await delay(300);
            await preencherCampoSeguro('dataDisponivel', '2024-09-01');
            await selecionarRadioSeguro('eventosNoturnos', 'ocasionalmente');
            await selecionarRadioSeguro('fimSemana', 'sim-sempre');
            await selecionarRadioSeguro('dormirFimSemana', 'sim');
            await selecionarRadioSeguro('viagens', 'apenas-nacionais');
            await selecionarRadioSeguro('passaporte', 'pode-providenciar');
            await delay(500);

            // 11. MORAR NO LOCAL
            console.log('ðŸ  11. Moradia no local...');
            await selecionarRadioSeguro('morarLocal', 'sim');
            await delay(300);

            // 12. PRETENSÃ•ES
            console.log('ðŸ’° 12. PretensÃµes salariais...');
            await preencherCampoSeguro('pretensaoSalarial', 'R$ 2.800,00');
            await selecionarSelectSeguro('regimeTrabalho', 'clt');
            await selecionarRadioSeguro('negociavel', 'sim');
            await delay(300);

            // 13. CERTIFICAÃ‡Ã•ES
            console.log('ðŸŽ“ 13. CertificaÃ§Ãµes...');
            const certificacoes = ['primeiros-socorros', 'seguranca-trabalho'];
            for (const cert of certificacoes) {
                const checkbox = document.querySelector(`input[name="certificacoes"][value="${cert}"]`);
                if (checkbox) {
                    checkbox.checked = true;
                    checkbox.dispatchEvent(new Event('change', { bubbles: true }));
                }
            }
            await delay(500);

            // 14. INFORMAÃ‡Ã•ES COMPLEMENTARES
            console.log('ðŸ“ 14. InformaÃ§Ãµes complementares...');
            await selecionarRadioSeguro('restricaoSaude', 'nao');
            await selecionarRadioSeguro('fuma', 'nao');
            await selecionarRadioSeguro('consumeAlcool', 'socialmente');
            await selecionarRadioSeguro('veiculoProprio', 'sim');
            await delay(300);
            await preencherCampoSeguro('tipoVeiculo', 'Carro popular');
            await delay(500);

            // 15. QUESTÃ•ES PROFISSIONAIS
            console.log('ðŸ’¬ 15. QuestÃµes profissionais...');
            await preencherCampoSeguro('situacoesEmergencia', 'Mantenho a calma e sigo protocolos de seguranÃ§a. Tenho conhecimentos bÃ¡sicos de primeiros socorros.');
            await preencherCampoSeguro('porqueContratar', 'Tenho experiÃªncia sÃ³lida, sou confiÃ¡vel e responsÃ¡vel. Cuido da propriedade como se fosse minha.');
            await preencherCampoSeguro('observacoesAdicionais', 'Sou dedicado, pontual e tenho facilidade para aprender novas tecnologias.');
            await delay(1000);

            // 16. DEBUG FINAL
            console.log('ðŸ” 16. Debug final...');
            const telefoneDisplay = document.getElementById('telefone')?.value;
            const telefoneHidden = document.getElementById('telefone_hidden')?.value;
            const whatsappDisplay = document.getElementById('whatsapp')?.value;
            const whatsappHidden = document.getElementById('whatsapp_hidden')?.value;
            
            console.log('ðŸ“± RESULTADO DOS TELEFONES:');
            console.log(`Telefone Display: "${telefoneDisplay}" â†’ Hidden: "${telefoneHidden}"`);
            console.log(`WhatsApp Display: "${whatsappDisplay}" â†’ Hidden: "${whatsappHidden}"`);
            
            if (telefoneHidden?.length >= 12 && whatsappHidden?.length >= 12) {
                console.log('âœ… Telefones formatados corretamente!');
            } else {
                console.log('âš ï¸ Problema na formataÃ§Ã£o dos telefones');
            }
            
            console.log('ðŸŽ‰ Preenchimento concluÃ­do!');
            console.log('ðŸš€ FormulÃ¡rio pronto para envio');

        } catch (error) {
            console.error('âŒ Erro durante o preenchimento:', error);
        }
    }

    // Iniciar preenchimento
    executarPreenchimento();
}

// ===== FUNÃ‡ÃƒO DE TESTE =====
function testarEnvio() {
    console.log('ðŸ§ª Testando envio...');
    const form = document.querySelector('form');
    if (form) {
        const submitEvent = new Event('submit', { bubbles: true, cancelable: true });
        form.dispatchEvent(submitEvent);
    } else {
        console.error('âŒ FormulÃ¡rio nÃ£o encontrado');
    }
}

// ===== FUNÃ‡ÃƒO DE VERIFICAÃ‡ÃƒO =====
function verificarCamposObrigatorios() {
    console.log('ðŸ” Verificando campos obrigatÃ³rios...');
    const required = document.querySelectorAll('[required]');
    const vazios = [];
    
    required.forEach(campo => {
        if (!campo.value || campo.value.trim() === '') {
            vazios.push({
                id: campo.id,
                name: campo.name,
                tipo: campo.tagName.toLowerCase(),
                elemento: campo
            });
        }
    });
    
    if (vazios.length > 0) {
        console.log('âš ï¸ Campos obrigatÃ³rios vazios:', vazios);
    } else {
        console.log('âœ… Todos os campos obrigatÃ³rios preenchidos!');
    }
    
    return vazios;
}

// ===== EXECUTAR =====
console.log('ðŸŽ¯ Comandos disponÃ­veis:');
console.log('preencherFormularioCaseiroCorrigido() // Preencher com aguardo de campos');
console.log('verificarCamposObrigatorios() // Verificar campos vazios');
console.log('testarEnvio() // Testar envio');

// Auto-executar
setTimeout(() => {
    if (confirm('ðŸ¤– Executar preenchimento automÃ¡tico inteligente?')) {
        preencherFormularioCaseiroCorrigido();
    }
}, 2000);